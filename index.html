<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<title>BitcoinWeather</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --brand:#0B2545; --green:#16a34a; --red:#dc2626; --line:rgba(255,255,255,.45);
    --shot-scale:1;           /* wird dynamisch gesetzt */
    --shot-maxw:560px;        /* schmaler f√ºr iPhone 16 Pro Portrait */
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:Inter,system-ui,Arial;color:#f8fafc;background:#000;overflow-x:hidden}

  /* Background video */
  .bg{position:fixed; inset:0; z-index:-2; overflow:hidden}
  .bg video{width:100%;height:100%;object-fit:cover; opacity:.72}
  .overlay{position:fixed; inset:0; z-index:-1; background:linear-gradient(180deg,rgba(0,0,0,.12),rgba(0,0,0,.30))}

  /* Header */
  header{
    position:sticky; top:0; z-index:20;
    display:flex; justify-content:space-between; align-items:center;
    padding:8px 16px; background:#fff; border-bottom:1px solid #e5e7eb;
  }
  .brand{display:flex; align-items:center; gap:6px}
  .brand-box{background:var(--brand); padding:6px; border-radius:8px; display:flex; align-items:center}
  .brand-box img{height:28px}
  .brand span{color:#0b1b2e; font-weight:800; font-size:16px}
  header nav a{margin-left:12px; color:#0b1b2e; text-decoration:none; font-size:14px}
  header nav a:hover{text-decoration:underline}

  /* ====== Normalansicht ====== */
  main.normal{max-width:760px;margin:0 auto;padding:0 16px 48px}

  .hero{color:#fff; text-align:center; padding:44px 0 12px}
  .coinline{display:flex; align-items:center; gap:12px; justify-content:center; margin-bottom:4px}
  .coinline .btclogo{width:54px;height:54px}
  .coinname{font-size:26px; font-weight:800}
  .mood{font-size:13px; color:#f1f5f9}

  .priceRow{display:flex; align-items:center; justify-content:center; gap:12px}
  .big{font-size:50px; font-weight:800; letter-spacing:.2px}
  .badge{font-size:13px; font-weight:800; padding:6px 10px; border-radius:8px}
  .badge.pos{background:rgba(22,163,74,.95); color:#fff}
  .badge.neg{background:rgba(220,38,38,.95); color:#fff}
  .hl{margin-top:8px; font-size:13px; color:#f8fafc}
  .hl span{color:#fff; font-weight:800}
  .outlook{margin:14px auto 0; max-width:640px; color:#fff; font-size:14px; line-height:1.55; text-align:center}

  .section{margin-top:24px; color:#fff}
  .bar{display:flex; align-items:center; gap:12px; color:#ffffff; font-size:14px; letter-spacing:.2px}
  .bar .line{height:1px; background:var(--line); flex:1}
  .bar .title{white-space:nowrap}

  .list{margin-top:6px; max-width:640px; margin-left:auto; margin-right:auto;}
  .row{display:flex; align-items:center; gap:10px; padding:12px 2px; border-bottom:1px solid var(--line); color:#ffffff}
  .row:last-child{border-bottom:none}
  .dt{flex:0 0 190px; font-size:17px; font-weight:700; color:#ffffff; font-variant-numeric: tabular-nums; font-feature-settings:"tnum" 1, "lnum" 1;}
  .wx{width:32px; text-align:center; font-size:22px}
  .price{flex:1; text-align:right; font-weight:700; color:#ffffff; font-size:18px; font-variant-numeric: tabular-nums; font-feature-settings:"tnum" 1, "lnum" 1;}
  .pctBadge{flex:0 0 92px; text-align:center; font-size:14px; font-weight:700; border-radius:8px; padding:6px 0; color:#fff}
  .pctBadge.pos{background:rgba(22,163,74,.95)}
  .pctBadge.neg{background:rgba(220,38,38,.95)}

  .tweetBox{margin:28px auto 0; max-width:640px; background:rgba(0,0,0,.22); border:1px solid rgba(255,255,255,.28); border-radius:12px; padding:12px; backdrop-filter: blur(4px);}
  .tweetBox h3{margin:0 0 8px; font-size:16px; color:#fff; text-align:center}
  .tw-actions{display:flex; gap:8px; flex-wrap:wrap; justify-content:center; align-items:center; margin-bottom:8px}
  .tw-actions .btn{min-width:160px}
  .tw-actions small{color:#e2e8f0; width:100%; text-align:center}
  textarea#tweet-text{width:100%; min-height:150px; resize:vertical; background:rgba(0,0,0,.15); color:#fff; border:1px solid rgba(255,255,255,.25); border-radius:10px; padding:10px; font-family:Inter,system-ui,Arial; font-size:14px; line-height:1.5;}
  .btn{background:#fff; color:#0b1b2e; border:none; padding:10px 12px; border-radius:8px; font-weight:700; cursor:pointer}
  .btn:hover{opacity:.92}

  footer{margin:26px 0 42px; color:#f1f5f9; font-size:12px; text-align:center}
  footer a{color:#fff; text-decoration:none}
  footer a:hover{text-decoration:underline}

  /* ====== Screenshot-Ansicht (eigene, kompakte Seite) ====== */
  #shot{display:none}
  body.screenshot header, body.screenshot footer, body.screenshot .tweetBox, body.screenshot main.normal{display:none}
  body.screenshot #shot{display:block}
  #shot{
    max-width:var(--shot-maxw);
    margin:0 auto;
    padding:0 18px 14px;
    transform-origin: top center;
    transform:scale(var(--shot-scale));
  }
  #shot .hero{padding:30px 0 8px}
  #shot .coinline .btclogo{width:46px;height:46px}
  #shot .coinname{font-size:22px}
  #shot .mood{font-size:12px}
  #shot .big{font-size:44px}
  #shot .hl{font-size:12px}
  #shot .outlook{font-size:13px; max-width:var(--shot-maxw); margin-top:10px}

  #shot .section{margin-top:16px}
  #shot .bar{font-size:13px}
  #shot .row{padding:10px 2px}
  #shot .dt{flex:0 0 172px; font-size:16px}
  #shot .price{font-size:17px}
  #shot .pctBadge{font-size:13px; flex:0 0 86px}

  /* Shot Disclaimer + Logo (im Flow, nicht fixed) */
  .shot-footer{
    display:flex; justify-content:flex-end; align-items:center; gap:10px;
    margin-top:14px;
  }
  .shot-footer .chip{
    display:flex; align-items:center; gap:8px;
    background:rgba(0,0,0,.35); border:1px solid rgba(255,255,255,.25);
    padding:6px 10px; border-radius:999px; backdrop-filter:blur(4px);
    color:#fff; font-size:12px; white-space:nowrap;
  }
  .shot-footer img{width:22px;height:22px; opacity:.95}

  /* Unsichtbarer Exit-Hotspot (Triple-Tap/Long-Press) ‚Äì keine sichtbaren Controls */
  body.screenshot #shotExitHotspot{
    position:fixed; inset:0; z-index:50; background:transparent;
  }
</style>
</head>
<body>
  <div class="bg"><video id="bgVideo" autoplay loop muted playsinline src="background_video_neutral.mp4"></video></div>
  <div class="overlay"></div>

  <header>
    <div class="brand">
      <div class="brand-box"><img src="./my_logo.png" alt="Logo"></div>
      <span>BitcoinWeather</span>
    </div>
    <nav>
      <a href="./index.html">Home</a>
      <a href="./how.html">How it works</a>
      <a href="./about.html">About</a>
      <a href="./contact.html">Contact</a>
      <a href="./privacy.html">Privacy</a>
      <a href="./disclaimer.html">Disclaimer</a>
    </nav>
  </header>

  <!-- ====== Normale Seite ====== -->
  <main class="normal">
    <section class="hero">
      <div class="coinline">
        <img class="btclogo" src="https://upload.wikimedia.org/wikipedia/commons/4/46/Bitcoin.svg" alt="BTC">
        <div>
          <div class="coinname">Bitcoin</div>
          <div class="mood" id="moodLabel">Cloudy</div>
        </div>
      </div>
      <div class="priceRow">
        <div class="big" id="priceBig">$--</div>
        <div id="changeBadge" class="badge">0.00%</div>
      </div>
      <div class="hl">H: <span id="hVal">--</span> ¬∑ L: <span id="lVal">--</span></div>
      <p id="outlook" class="outlook">Loading short-term outlook‚Ä¶</p>
    </section>

    <!-- Forecast sections -->
    <section class="section"><div class="bar"><div class="line"></div><div class="title">Prediction for next 3 Days</div><div class="line"></div></div><div class="list" id="list3"></div></section>
    <section class="section"><div class="bar"><div class="line"></div><div class="title">Prediction for next 7 Days</div><div class="line"></div></div><div class="list" id="list7"></div></section>
    <section class="section"><div class="bar"><div class="line"></div><div class="title">Prediction for next 30 Days</div><div class="line"></div></div><div class="list" id="list30"></div></section>
    <section class="section"><div class="bar"><div class="line"></div><div class="title">Prediction for next 60 Days</div><div class="line"></div></div><div class="list" id="list60"></div></section>
    <section class="section"><div class="bar"><div class="line"></div><div class="title">Prediction for next 90 Days</div><div class="line"></div></div><div class="list" id="list90"></div></section>
    <section class="section"><div class="bar"><div class="line"></div><div class="title">Prediction for next 180 Days</div><div class="line"></div></div><div class="list" id="list180"></div></section>
    <section class="section"><div class="bar"><div class="line"></div><div class="title">Prediction for next 360 Days</div><div class="line"></div></div><div class="list" id="list360"></div></section>

    <!-- Tweet helper -->
    <section class="tweetBox">
      <h3>Tweet this Forecast</h3>
      <div class="tw-actions">
        <button class="btn" id="copyBtn">Copy text</button>
        <button class="btn" id="shareBtn">Share (iOS/Android)</button>
        <button class="btn" id="openTwitterBtn">Open in Twitter</button>
        <button class="btn" id="screenshotBtn">Toggle Screenshot Mode</button>
        <small>Tip: Toggle Screenshot, take a full-screen shot, then tweet.</small>
      </div>
      <textarea id="tweet-text" readonly>Generating‚Ä¶</textarea>
    </section>
  </main>

  <!-- ====== Screenshot-Seite (kompakt) ====== -->
  <main id="shot" aria-hidden="true">
    <section class="hero">
      <div class="coinline">
        <img class="btclogo" src="https://upload.wikimedia.org/wikipedia/commons/4/46/Bitcoin.svg" alt="BTC">
        <div>
          <div class="coinname">Bitcoin</div>
          <div class="mood" id="shotMood">‚Äì</div>
        </div>
      </div>
      <div class="priceRow">
        <div class="big" id="shotPrice">$--</div>
        <div id="shotChange" class="badge">0.00%</div>
      </div>
      <div class="hl">H: <span id="shotH">--</span> ¬∑ L: <span id="shotL">--</span></div>
      <p id="shotOutlook" class="outlook">Loading‚Ä¶</p>
    </section>

    <!-- kompakte Listen -->
    <section class="section">
      <div class="bar"><div class="line"></div><div class="title">Prediction for next 3 Days</div><div class="line"></div></div>
      <div class="list" id="shot3"></div>
    </section>
    <section class="section">
      <div class="bar"><div class="line"></div><div class="title">Next Milestones</div><div class="line"></div></div>
      <div class="list" id="shotMilestones"></div>
    </section>

    <!-- Logo + Disclaimer im Shot -->
    <div class="shot-footer">
      <div class="chip">
        <img src="my_logo.png" alt="Logo"><span>Informational only ¬∑ Not financial advice</span>
      </div>
    </div>
  </main>

  <!-- unsichtbarer Exit-Hotspot im Shot -->
  <div id="shotExitHotspot" hidden></div>

  <footer>
    ¬© <span id="year"></span> BitcoinWeather ‚Äî Informational only, not investment advice. ¬∑ 
    <a href="./privacy.html">Privacy</a> ¬∑ <a href="./disclaimer.html">Disclaimer</a> ¬∑ <a href="./contact.html">Contact</a>
  </footer>

<script>
  const SYMBOL='BTCUSDT';
  const videos={
    very_good:'background_video_very_good.mp4',
    good:'background_video_good.mp4',
    neutral:'background_video_neutral.mp4',
    bad:'background_video_bad.mp4',
    very_bad:'background_video_very_bad.mp4'
  };

  // Skala
  const TH_VERY_GOOD = 5.0;  // > +5%
  const TH_GOOD      = 2.0;  // > +2%
  const TH_NEUTRAL   = -1.0; // > -1%
  const TH_VERY_BAD  = -5.0; // < -5%

  const fmtUSD0   = n => n.toLocaleString('en-US',{style:'currency',currency:'USD',maximumFractionDigits:0,minimumFractionDigits:0});
  const fmtUSD0No = n => n.toLocaleString('en-US',{maximumFractionDigits:0,minimumFractionDigits:0});

  function pickVideo(p){
    if (p > TH_VERY_GOOD) return videos.very_good;
    if (p > TH_GOOD)      return videos.good;
    if (p > TH_NEUTRAL)   return videos.neutral;
    if (p < TH_VERY_BAD)  return videos.very_bad;
    return videos.bad;
  }
  function moodText(p){
    if (p > TH_VERY_GOOD) return 'Euphoric';
    if (p > TH_GOOD)      return 'Sunny';
    if (p > TH_NEUTRAL)   return 'Cloudy';
    if (p < TH_VERY_BAD)  return 'Thunderstorm';
    return 'Rainy';
  }
  function moodIconFor(p){
    if (p > TH_VERY_GOOD) return 'üöÄ';
    if (p > TH_GOOD)      return '‚òÄÔ∏è';
    if (p > TH_NEUTRAL)   return '‚õÖÔ∏è';
    if (p < TH_VERY_BAD)  return '‚õàÔ∏è';
    return 'üåßÔ∏è';
  }

  document.getElementById('year').textContent = new Date().getFullYear();

  // Live price via WebSocket + simple fallback
  (function wsLive(){
    const el=document.getElementById('priceBig');
    let got=false;
    try{
      const ws=new WebSocket('wss://stream.binance.com:9443/ws/btcusdt@trade');
      ws.onmessage=e=>{ const p=parseFloat(JSON.parse(e.data).p); if(isFinite(p)){ el.textContent=fmtUSD0(p); got=true; }};
      ws.onclose=()=>setTimeout(wsLive,3000);
      setTimeout(async ()=>{ if(!got){ try{ const r=await fetch('https://api.binance.com/api/v3/ticker/price?symbol='+SYMBOL); const j=await r.json(); el.textContent=fmtUSD0(parseFloat(j.price)); }catch{}}},2000);
    }catch{}
  })();

  async function load24h(){
    const badge=document.getElementById('changeBadge');
    const h=document.getElementById('hVal'); const l=document.getElementById('lVal');
    const mood=document.getElementById('moodLabel');
    const vid=document.getElementById('bgVideo');
    try{
      const r=await fetch('https://api.binance.com/api/v3/ticker/24hr?symbol='+SYMBOL);
      const j=await r.json(); const pct=parseFloat(j.priceChangePercent);
      const cls=pct>=0?'pos':'neg'; const arrow=pct>=0?'‚ñ≤ ':'‚ñº ';
      badge.className='badge '+cls; badge.textContent=arrow+Math.abs(pct).toFixed(2)+'%';
      h.textContent=fmtUSD0(parseFloat(j.highPrice)); l.textContent=fmtUSD0(parseFloat(j.lowPrice));
      vid.src=pickVideo(pct);
      mood.textContent=moodText(pct);

      // auch Shot-Header aktualisieren
      document.getElementById('shotChange').className = 'badge ' + (pct>=0?'pos':'neg');
      document.getElementById('shotChange').textContent = arrow+Math.abs(pct).toFixed(2)+'%';
      document.getElementById('shotH').textContent = fmtUSD0(parseFloat(j.highPrice));
      document.getElementById('shotL').textContent = fmtUSD0(parseFloat(j.lowPrice));
      document.getElementById('shotMood').textContent = moodText(pct);
    }catch{}
  }
  load24h();

  // Forecast calculation (46-day weighted log-returns)
  const LOOKBACK=46;
  const GROUPS = { three:[1,2,3], seven:[7], thirty:[30], sixty:[60], ninety:[90], oneeighty:[180], threesixty:[360]};
  const NEED=Math.max(...Object.values(GROUPS).flat())+LOOKBACK+5;

  async function fetchCloses(n){
    try{
      const url=`https://api.binance.com/api/v3/klines?symbol=${SYMBOL}&interval=1d&limit=${n+2}`;
      const res=await fetch(url); const k=await res.json(); const now=Date.now();
      const closed=k.filter(r=>r[6]<=now).map(r=>({ts:r[6], close:parseFloat(r[4])}));
      const pr=await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${SYMBOL}`);
      const live=parseFloat((await pr.json()).price);
      const arr=closed.slice(-(n+1)); arr[arr.length-1]={ts:Date.now(), close:live};
      return arr;
    }catch(e){ console.error(e); return []; }
  }

  function makeForecast(closes, days){
    const last=closes[closes.length-1].close, asOf=closes[closes.length-1].ts;
    const W=LOOKBACK, denom=W*(W+1)/2;
    return days.map(m=>{
      let num=0;
      for(let i=1;i<=W;i++){
        const a=(closes.length-1)-i, b=(closes.length-1)-i-m;
        if(a<0||b<0) continue;
        const ct_i=closes[a].close, ct_im=closes[b].close;
        if(!(ct_i>0&&ct_im>0)) continue;
        num += Math.log(1+(ct_i-ct_im)/ct_im) * (W-i);
      }
      const R=num/denom, factor=Math.exp(R), price=last*factor, pct=(factor-1)*100;
      const date=new Date(asOf+m*864e5).toLocaleDateString('en-US',{month:'short', day:'2-digit', year:'numeric'});
      return { m, date, price, pct, icon:moodIconFor(pct) };
    });
  }

  const fmtRow = x => `<div class="row">
      <div class="dt">${x.date}</div>
      <div class="wx">${x.icon}</div>
      <div class="price">$${fmtUSD0No(x.price)}</div>
      <div class="pctBadge ${x.pct>=0?'pos':'neg'}">${x.pct>=0?'‚ñ≤ ':'‚ñº '}${Math.abs(x.pct).toFixed(2)}%</div>
    </div>`;

  function writeOutlook(short3AvgPct, weekPct){
    const out=document.getElementById('outlook');
    const tone3 = short3AvgPct>1 ? 'optimistic with brighter skies ahead'
                 : short3AvgPct>0.2 ? 'steady with calm conditions'
                 : short3AvgPct>-0.2 ? 'largely calm and balanced'
                 : short3AvgPct>-1 ? 'showing signs of clouds moving in'
                 : 'turning stormy with possible showers';
    const weekTone = weekPct>1 ? 'further clear skies'
                    : weekPct>-1 ? 'mixed conditions'
                    : 'extended periods of clouds';
    const txt = `In the short term, the market outlook appears ${tone3}. Over the week, forecasts point to ${weekTone} around ${Math.abs(weekPct).toFixed(2)}%. As always, occasional storms cannot be ruled out.`;
    out.textContent = txt;
    // in Shot spiegeln
    document.getElementById('shotOutlook').textContent = txt;
  }

  function buildTweet({current, g7, g30, g90, g180, g360}){
    const today = new Date().toLocaleDateString('en-US',{month:'short', day:'numeric', year:'numeric'});
    const g7p = g7?.pct ?? 0;
    const mood  = (g7p > TH_VERY_GOOD) ? 'üöÄ' : (g7p > TH_GOOD) ? '‚òÄÔ∏è' : (g7p > TH_NEUTRAL) ? '‚õÖÔ∏è' : (g7p < TH_VERY_BAD) ? '‚õàÔ∏è' : 'üåßÔ∏è';
    return [
      `${mood} BitcoinWeather Forecast ‚Äì ${today}`,
      `Current Price: ${fmtUSD0(current)}`,
      `+7d: ${fmtUSD0(g7.price)} (${(g7.pct>=0?'+':'-')}${Math.abs(g7.pct).toFixed(2)}%)`,
      `+30d: ${fmtUSD0(g30.price)} (${(g30.pct>=0?'+':'-')}${Math.abs(g30.pct).toFixed(2)}%)`,
      `+90d: ${fmtUSD0(g90.price)} (${(g90.pct>=0?'+':'-')}${Math.abs(g90.pct).toFixed(2)}%)`,
      `+180d: ${fmtUSD0(g180.price)} (${(g180.pct>=0?'+':'-')}${Math.abs(g180.pct).toFixed(2)}%)`,
      `+360d: ${fmtUSD0(g360.price)} (${(g360.pct>=0?'+':'-')}${Math.abs(g360.pct).toFixed(2)}%)`,
      ``,
      `üìä #Bitcoin #BTC #Crypto #CryptoForecast #BitcoinWeather #CryptoMarkets`
    ].join('\n');
  }

  // Buttons (nur Normalansicht)
  const copyBtn=()=>{ const ta=document.getElementById('tweet-text'); if(navigator.clipboard) navigator.clipboard.writeText(ta.value); else{ ta.select(); document.execCommand('copy'); } };
  document.getElementById('copyBtn').addEventListener('click',copyBtn);
  document.getElementById('shareBtn').addEventListener('click',()=>{ const t=document.getElementById('tweet-text').value; if(navigator.share) navigator.share({text:t}); else window.open('https://twitter.com/intent/tweet?text='+encodeURIComponent(t),'_blank');});
  document.getElementById('openTwitterBtn').addEventListener('click',()=>{ const t=document.getElementById('tweet-text').value; window.open('https://twitter.com/intent/tweet?text='+encodeURIComponent(t),'_blank');});

  // Screenshot Mode: Toggle + Auto-Scale + Exit via Triple-Tap / Long-Press
  const shotToggle = document.getElementById('screenshotBtn');
  const shotView   = document.getElementById('shot');
  const shotExit   = document.getElementById('shotExitHotspot');

  function adjustShotScale(){
    const h = shotView.getBoundingClientRect().height;
    const avail = window.innerHeight - 4;
    let s = Math.min(1, avail / h);
    s = Math.max(0.70, Math.min(1, s*0.992)); // kleine Sicherheitsmarge
    document.documentElement.style.setProperty('--shot-scale', s.toFixed(3));
    window.scrollTo(0,0);
  }
  function enterShot(){
    document.body.classList.add('screenshot');
    shotExit.hidden=false;
    adjustShotScale();
  }
  function exitShot(){
    document.body.classList.remove('screenshot');
    shotExit.hidden=true;
    document.documentElement.style.removeProperty('--shot-scale');
    window.scrollTo(0,0);
  }
  shotToggle.addEventListener('click', ()=> document.body.classList.contains('screenshot') ? exitShot() : enterShot() );
  window.addEventListener('resize', ()=>{ if(document.body.classList.contains('screenshot')) adjustShotScale(); });
  window.addEventListener('orientationchange', ()=>{ if(document.body.classList.contains('screenshot')) setTimeout(adjustShotScale,250); });

  // Triple-Tap & Long-Press zum Beenden (keine sichtbaren Buttons)
  (function setupShotExitGestures(){
    let taps=0, last=0, pressT=null, pressed=false;
    function reset(){ taps=0; last=0; }
    function tap(){
      const now=Date.now();
      if(now-last<400) taps++; else taps=1;
      last=now;
      if(taps>=3) { exitShot(); reset(); }
    }
    shotExit.addEventListener('touchstart',()=>{ pressed=true; pressT=setTimeout(()=>{ if(pressed) { exitShot(); pressed=false; } },700); }, {passive:true});
    shotExit.addEventListener('touchend',()=>{ pressed=false; clearTimeout(pressT); tap(); }, {passive:true});
    shotExit.addEventListener('click', tap);
  })();

  // Hauptlauf: Daten laden, normale + Screenshot-Listen f√ºllen
  async function run(){
    try{
      const closes=await fetchCloses(NEED);
      if(!closes.length) throw new Error('No data');
      const g3   = makeForecast(closes, GROUPS.three);
      const g7   = makeForecast(closes, GROUPS.seven);
      const g30  = makeForecast(closes, GROUPS.thirty);
      const g60  = makeForecast(closes, GROUPS.sixty);
      const g90  = makeForecast(closes, GROUPS.ninety);
      const g180 = makeForecast(closes, GROUPS.oneeighty);
      const g360 = makeForecast(closes, GROUPS.threesixty);

      // Normalansicht
      document.getElementById('list3').innerHTML   = g3.map(fmtRow).join('');
      document.getElementById('list7').innerHTML   = g7.map(fmtRow).join('');
      document.getElementById('list30').innerHTML  = g30.map(fmtRow).join('');
      document.getElementById('list60').innerHTML  = g60.map(fmtRow).join('');
      document.getElementById('list90').innerHTML  = g90.map(fmtRow).join('');
      document.getElementById('list180').innerHTML = g180.map(fmtRow).join('');
      document.getElementById('list360').innerHTML = g360.map(fmtRow).join('');

      // Tweet-Text
      const current = closes[closes.length-1]?.close ?? 0;
      document.getElementById('tweet-text').value = buildTweet({
        current, g7:g7[0], g30:g30[0], g90:g90[0], g180:g180[0], g360:g360[0]
      });

      // Shot-Header Preis
      document.getElementById('shotPrice').textContent = fmtUSD0(current);

      // Shot-Listen: 3-Tage (3 Zeilen) + Milestones (erste Zeile jeder Gruppe)
      document.getElementById('shot3').innerHTML = g3.slice(0,3).map(fmtRow).join('');
      const milestones = [g7[0], g30[0], g60[0], g90[0], g180[0], g360[0]].filter(Boolean);
      document.getElementById('shotMilestones').innerHTML = milestones.map(fmtRow).join('');
    }catch(e){
      console.error(e);
      ['list3','list7','list30','list60','list90','list180','list360'].forEach(id=>{
        const el=document.getElementById(id); if(el) el.innerHTML='<div class="row"><div class="dt">Forecast unavailable</div></div>';
      });
    }
  }
  run();
</script>
</body>
</html>
